From 0ea42667373f365521c11fd98b3f06847e973b95 Mon Sep 17 00:00:00 2001
From: Jeremy Allison <jallison@ciq.com>
Date: Thu, 4 Apr 2024 18:03:54 -0700
Subject: [PATCH 03/09] CVE-2023-3961.patch

---
 source3/lib/util_sock.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/source3/lib/util_sock.c b/source3/lib/util_sock.c
index 85dc3ef..bbdc6d8 100644
--- a/source3/lib/util_sock.c
+++ b/source3/lib/util_sock.c
@@ -954,6 +954,12 @@ int create_pipe_sock(const char *socket_dir,
                 goto out_close;
 	}
 
+	/* CVE-2023-3961 - socket names must not contain .. or '/' */
+	if (ISDOTDOT(socket_name) || strchr(socket_name, '/')!=NULL) {
+		errno = ENOENT;
+		goto out_close;
+	}
+
 	if (asprintf(&path, "%s/%s", socket_dir, socket_name) == -1) {
                 goto out_close;
 	}
-- 
2.39.3

